<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" >

  <title>SnapStock</title>


  </head>

  <body>

    {% include 'navbar_private.html' %}

    <main>

      <div class="input-container">
        <input type="text" id="symbol-input" placeholder="Enter Stock Symbol" class="centered-input">
        <button type="submit" id="submit-btn" class="submit-button">Submit</button>
      </div>

      <div id="spinner-container" class="spinner-container">
        <div id="spinner-box-js" class="spinner-box">
          <div id="spinner" class="spinner"></div>
          <div class="spinner-text">Generating Output</div>
        </div>
      </div>

      <div id="data-output" class="output-container not-visible">
        <div class="page-tabs">
          <div id="tab-1" class="tab active-tab">Financial Performance</div>
          <div id="tab-2" class="tab">Growth and Outlook</div>
          <div id="tab-3" class="tab">Risk Assessment</div>
        </div>

        <div class="data-content">
          <div id="data-content-1" class="summary-1"></div>
          <div id="data-content-2" class="summary-2 not-visible"></div>
          <div id="data-content-3" class="summary-3 not-visible"></div>
        </div>
      </div>


    </main>

    <script>
      const symbol = document.getElementById('symbol-input');
      const dataOutput = document.getElementById('data-output');
      const submitBtn = document.getElementById('submit-btn');

      const tab1 = document.getElementById('tab-1');
      const tab2 = document.getElementById('tab-2');
      const tab3 = document.getElementById('tab-3');

      const dataContent1 = document.getElementById('data-content-1');
      const dataContent2 = document.getElementById('data-content-2');
      const dataContent3 = document.getElementById('data-content-3');

      submitBtn.addEventListener('click', () => {
    let symbolValue = symbol.value;

    if (symbolValue) {
        submitBtn.innerText = 'Analyzing';
        submitBtn.classList.add('submit-clicked');

        getSummary(symbolValue)
            .then(data => {
                renderSummaries(data);  // Assuming renderSummaries does not need to return a Promise
            })
            .catch(error => {
                console.error('Error with Fetch operation: ', error);
                // Optionally update UI to reflect error state
            })
            .finally(() => {
                submitBtn.innerText = 'Submit';
                submitBtn.classList.remove('submit-clicked');
            });
        }
    });

      tab1.addEventListener('click', () => {
        tab1.classList.add('active-tab');
        tab2.classList.remove('active-tab');
        tab3.classList.remove('active-tab');

        dataContent1.classList.remove('not-visible');
        dataContent2.classList.add('not-visible');
        dataContent3.classList.add('not-visible');
      })

      tab2.addEventListener('click', () => {
        tab1.classList.remove('active-tab');
        tab2.classList.add('active-tab');
        tab3.classList.remove('active-tab');

        dataContent1.classList.add('not-visible');
        dataContent2.classList.remove('not-visible');
        dataContent3.classList.add('not-visible');
      })

      tab3.addEventListener('click', () => {
        tab1.classList.remove('active-tab');
        tab2.classList.remove('active-tab');
        tab3.classList.add('active-tab');

        dataContent1.classList.add('not-visible');
        dataContent2.classList.add('not-visible');
        dataContent3.classList.remove('not-visible');
      })


      function getSummary(symbolValue) {
          showSpinner();
          return fetch('/api/summary', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              credentials: 'same-origin',
              body: JSON.stringify({ symbol: symbolValue })
          }).then(response => {
              if (response.ok) {
                  return response.json(); // Return the promise to the next then in the chain
              } else {
                  throw new Error('Failed to fetch summary');
              }
          }).finally(() => {
              hideSpinner();
          });
      }


    function renderSummaries(summaries) {
      dataContent1.innerText = summaries['performance'];
      dataContent2.innerText = summaries['outlook'];
      dataContent3.innerText = summaries['risk'];

      dataOutput.classList.remove('not-visible');
    }


    function showSpinner() {
        document.getElementById('spinner-box-js').style.display = 'block';
    }

    function hideSpinner() {
        document.getElementById('spinner-box-js').style.display = 'none';
    }



    </script>

    <script src="{{ url_for('static', filename='login-auth.js') }}" type="module"></script>
    <script src="{{ url_for('static', filename='scripts.js') }}" type="module"></script>

  </body>
  

</html>